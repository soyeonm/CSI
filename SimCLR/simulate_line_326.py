#For https://github.com/soyeonm/CSI/commit/856ec8493bd37cea54102428b97c7027e5302c44

one_row = torch.tensor(np.expand_dims(np.arange(136), 0))
mat = torch.cat([one_row + 1000*i for i in range(36)], dim=0)   #shape [36, 136]
mat_r = mat.reshape(2*args.permclr_views, (M**2) * (args.permclr_views**2 + 1))       


#Reshape mat into [8 x 36*17] or [36*17, 8]

>>> mat_r3 = mat.reshape(36*17, 8)
>>> mat_r3[0]
tensor([0, 1, 2, 3, 4, 5, 6, 7])
>>> mat_r3[1]
tensor([ 8,  9, 10, 11, 12, 13, 14, 15])
>>> mat_r3[17]
tensor([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007])
>>> mat_r3[16]
tensor([128, 129, 130, 131, 132, 133, 134, 135])
>>> mat_r3[17+16]
tensor([1128, 1129, 1130, 1131, 1132, 1133, 1134, 1135])
-> Looks reshaped to (36*17, 8)

#Now try with stacked 128
mat_128 = torch.cat([mat.unsqueeze(0)]*128, axis=0) #torch.Size([128, 36, 136])
mat_r3_128 = mat_128.reshape(128, 36*17, 8) #shape 128, 36*17, 8

>>> mat_r3_128[:, 0] 
tensor([[0, 1, 2,  ..., 5, 6, 7],
        [0, 1, 2,  ..., 5, 6, 7],
        [0, 1, 2,  ..., 5, 6, 7],
        ...,
        [0, 1, 2,  ..., 5, 6, 7],
        [0, 1, 2,  ..., 5, 6, 7],
        [0, 1, 2,  ..., 5, 6, 7]])
>>> mat_r3_128[:, 0].shape
torch.Size([128, 8])
>>> mat_r3_128[:, 1].shape
torch.Size([128, 8])
>>> mat_r3_128[:, 1]      
tensor([[ 8,  9, 10,  ..., 13, 14, 15],
        [ 8,  9, 10,  ..., 13, 14, 15],
        [ 8,  9, 10,  ..., 13, 14, 15],
        ...,
        [ 8,  9, 10,  ..., 13, 14, 15],
        [ 8,  9, 10,  ..., 13, 14, 15],
        [ 8,  9, 10,  ..., 13, 14, 15]])
>>> mat_r3_128[:, 16]
tensor([[128, 129, 130,  ..., 133, 134, 135],
        [128, 129, 130,  ..., 133, 134, 135],
        [128, 129, 130,  ..., 133, 134, 135],
        ...,
        [128, 129, 130,  ..., 133, 134, 135],
        [128, 129, 130,  ..., 133, 134, 135],
        [128, 129, 130,  ..., 133, 134, 135]])
>>> mat_r3_128[:, 17]
tensor([[1000, 1001, 1002,  ..., 1005, 1006, 1007],
        [1000, 1001, 1002,  ..., 1005, 1006, 1007],
        [1000, 1001, 1002,  ..., 1005, 1006, 1007],
        ...,
        [1000, 1001, 1002,  ..., 1005, 1006, 1007],
        [1000, 1001, 1002,  ..., 1005, 1006, 1007],
        [1000, 1001, 1002,  ..., 1005, 1006, 1007]])
>>> mat_r3_128[:, 33]
tensor([[1128, 1129, 1130,  ..., 1133, 1134, 1135],
        [1128, 1129, 1130,  ..., 1133, 1134, 1135],
        [1128, 1129, 1130,  ..., 1133, 1134, 1135],
        ...,
        [1128, 1129, 1130,  ..., 1133, 1134, 1135],
        [1128, 1129, 1130,  ..., 1133, 1134, 1135],
        [1128, 1129, 1130,  ..., 1133, 1134, 1135]])

-> Looks okay